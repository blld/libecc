//
//  text.c
//  libecc
//
//  Copyright (c) 2019 Aur√©lien Bouilland
//  Licensed under MIT license, see LICENSE.txt file in project root
//

#define Implementation
#include "text.h"

// MARK: - Private

#define textMake(N, T) \
	static const char N ## Literal[] = T; \
	const struct Text Text(N) = { .bytes = N ## Literal, .length = sizeof N ## Literal - 1 }

textMake(undefined, "undefined");
textMake(null, "null");
textMake(true, "true");
textMake(false, "false");
textMake(boolean, "boolean");
textMake(number, "number");
textMake(string, "string");
textMake(object, "object");
textMake(function, "function");
textMake(zero, "0");
textMake(one, "1");
textMake(nan, "NaN");
textMake(infinity, "Infinity");
textMake(negativeInfinity, "-Infinity");
textMake(nativeCode, "[native code]");
textMake(empty, "");
textMake(emptyRegExp, "/(?:)/");

textMake(nullType, "[object Null]");
textMake(undefinedType, "[object Undefined]");
textMake(objectType, "[object Object]");
textMake(errorType, "[object Error]");
textMake(arrayType, "[object Array]");
textMake(stringType, "[object String]");
textMake(regexpType, "[object RegExp]");
textMake(numberType, "[object Number]");
textMake(booleanType, "[object Boolean]");
textMake(dateType, "[object Date]");
textMake(functionType, "[object Function]");
textMake(argumentsType, "[object Arguments]");
textMake(mathType, "[object Math]");
textMake(globalType, "[object Global]");

textMake(errorName, "Error");
textMake(rangeErrorName, "RangeError");
textMake(referenceErrorName, "ReferenceError");
textMake(syntaxErrorName, "SyntaxError");
textMake(typeErrorName, "TypeError");
textMake(uriErrorName, "URIError");
textMake(inputErrorName, "InputError");

// MARK: - Static Members

static const char lowers[] = {
	'\x61','\x62','\x63','\x64','\x65','\x66','\x67','\x68','\x69','\x6a',
	'\x6b','\x6c','\x6d','\x6e','\x6f','\x70','\x71','\x72','\x73','\x74',
	'\x75','\x76','\x77','\x78','\x79','\x7a','\xC2','\xB5','\xC3','\xA0',
	'\xC3','\xA1','\xC3','\xA2','\xC3','\xA3','\xC3','\xA4','\xC3','\xA5',
	'\xC3','\xA6','\xC3','\xA7','\xC3','\xA8','\xC3','\xA9','\xC3','\xAA',
	'\xC3','\xAB','\xC3','\xAC','\xC3','\xAD','\xC3','\xAE','\xC3','\xAF',
	'\xC3','\xB0','\xC3','\xB1','\xC3','\xB2','\xC3','\xB3','\xC3','\xB4',
	'\xC3','\xB5','\xC3','\xB6','\xC3','\xB8','\xC3','\xB9','\xC3','\xBA',
	'\xC3','\xBB','\xC3','\xBC','\xC3','\xBD','\xC3','\xBE','\xC3','\x9F',
	'\xC3','\xBF','\xC4','\x81','\xC4','\x83','\xC4','\x85','\xC4','\x87',
	'\xC4','\x89','\xC4','\x8B','\xC4','\x8D','\xC4','\x8F','\xC4','\x91',
	'\xC4','\x93','\xC4','\x95','\xC4','\x97','\xC4','\x99','\xC4','\x9B',
	'\xC4','\x9D','\xC4','\x9F','\xC4','\xA1','\xC4','\xA3','\xC4','\xA5',
	'\xC4','\xA7','\xC4','\xA9','\xC4','\xAB','\xC4','\xAD','\xC4','\xAF',
	'\x69','\xCC','\x87','\xC4','\xB1','\xC4','\xB3','\xC4','\xB5','\xC4',
	'\xB7','\xC4','\xBA','\xC4','\xBC','\xC4','\xBE','\xC5','\x80','\xC5',
	'\x82','\xC5','\x84','\xC5','\x86','\xC5','\x88','\xC5','\x89',255   ,
	'\xC5','\x8B','\xC5','\x8D','\xC5','\x8F','\xC5','\x91','\xC5','\x93',
	'\xC5','\x95','\xC5','\x97','\xC5','\x99','\xC5','\x9B','\xC5','\x9D',
	'\xC5','\x9F','\xC5','\xA1','\xC5','\xA3','\xC5','\xA5','\xC5','\xA7',
	'\xC5','\xA9','\xC5','\xAB','\xC5','\xAD','\xC5','\xAF','\xC5','\xB1',
	'\xC5','\xB3','\xC5','\xB5','\xC5','\xB7','\xC5','\xBA','\xC5','\xBC',
	'\xC5','\xBE','\xC5','\xBF','\xC6','\x80','\xC9','\x93','\xC6','\x83',
	'\xC6','\x85','\xC9','\x94','\xC6','\x88','\xC9','\x96','\xC9','\x97',
	'\xC6','\x8C','\xC7','\x9D','\xC9','\x99','\xC9','\x9B','\xC6','\x92',
	'\xC9','\xA0','\xC9','\xA3','\xC6','\x95','\xC9','\xA9','\xC9','\xA8',
	'\xC6','\x99','\xC6','\x9A','\xC9','\xAF','\xC9','\xB2','\xC6','\x9E',
	'\xC9','\xB5','\xC6','\xA1','\xC6','\xA3','\xC6','\xA5','\xCA','\x80',
	'\xC6','\xA8','\xCA','\x83','\xC6','\xAD','\xCA','\x88','\xC6','\xB0',
	'\xCA','\x8A','\xCA','\x8B','\xC6','\xB4','\xC6','\xB6','\xCA','\x92',
	'\xC6','\xB9','\xC6','\xBD','\xC6','\xBF','\xC7','\x86','\xC7','\x89',
	'\xC7','\x8C','\xC7','\x8E','\xC7','\x90','\xC7','\x92','\xC7','\x94',
	'\xC7','\x96','\xC7','\x98','\xC7','\x9A','\xC7','\x9C','\xC7','\x9F',
	'\xC7','\xA1','\xC7','\xA3','\xC7','\xA5','\xC7','\xA7','\xC7','\xA9',
	'\xC7','\xAB','\xC7','\xAD','\xC7','\xAF','\xC7','\xB0',255   ,'\xC7',
	'\xB3','\xC7','\xB5','\xC7','\xB9','\xC7','\xBB','\xC7','\xBD','\xC7',
	'\xBF','\xC8','\x81','\xC8','\x83','\xC8','\x85','\xC8','\x87','\xC8',
	'\x89','\xC8','\x8B','\xC8','\x8D','\xC8','\x8F','\xC8','\x91','\xC8',
	'\x93','\xC8','\x95','\xC8','\x97','\xC8','\x99','\xC8','\x9B','\xC8',
	'\x9D','\xC8','\x9F','\xC8','\xA3','\xC8','\xA5','\xC8','\xA7','\xC8',
	'\xA9','\xC8','\xAB','\xC8','\xAD','\xC8','\xAF','\xC8','\xB1','\xC8',
	'\xB3','\xE2','\xB1','\xA5','\xC8','\xBC','\xE2','\xB1','\xA6','\xC8',
	'\xBF',255   ,'\xC9','\x80',255   ,'\xC9','\x82','\xCA','\x89','\xCA',
	'\x8C','\xC9','\x87','\xC9','\x89','\xC9','\x8B','\xC9','\x8D','\xC9',
	'\x8F','\xC9','\x90',255   ,'\xC9','\x91',255   ,'\xC9','\x92',255   ,
	'\xC9','\x9C',255   ,'\xC9','\xA1',255   ,'\xC9','\xA5',255   ,'\xC9',
	'\xA6',255   ,'\xC9','\xAB',255   ,'\xC9','\xAC',255   ,'\xC9','\xB1',
	255   ,'\xC9','\xBD',255   ,'\xCA','\x87',255   ,'\xCA','\x9E',255   ,
	'\xCD','\x85','\xCD','\xB1','\xCD','\xB3','\xCD','\xB7','\xCD','\xBB',
	'\xCD','\xBC','\xCD','\xBD','\xCF','\xB3','\xCE','\xAC','\xCE','\xAD',
	'\xCE','\xAE','\xCE','\xAF','\xCF','\x8C','\xCF','\x8D','\xCF','\x8E',
	'\xCE','\x90',255   ,255   ,255   ,255   ,'\xCE','\xB1','\xCE','\xB2',
	'\xCE','\xB3','\xCE','\xB4','\xCE','\xB5','\xCE','\xB6','\xCE','\xB7',
	'\xCE','\xB8','\xCE','\xB9','\xCE','\xBA','\xCE','\xBB','\xCE','\xBC',
	'\xCE','\xBD','\xCE','\xBE','\xCE','\xBF','\xCF','\x80','\xCF','\x81',
	'\xCF','\x83','\xCF','\x84','\xCF','\x85','\xCF','\x86','\xCF','\x87',
	'\xCF','\x88','\xCF','\x89','\xCF','\x8A','\xCF','\x8B','\xCE','\xB0',
	255   ,255   ,255   ,255   ,'\xCF','\x82','\xCF','\x97','\xCF','\x90',
	'\xCF','\x91','\xCF','\x95','\xCF','\x96','\xCF','\x99','\xCF','\x9B',
	'\xCF','\x9D','\xCF','\x9F','\xCF','\xA1','\xCF','\xA3','\xCF','\xA5',
	'\xCF','\xA7','\xCF','\xA9','\xCF','\xAB','\xCF','\xAD','\xCF','\xAF',
	'\xCF','\xB0','\xCF','\xB1','\xCF','\xB2','\xCE','\xB8','\xCF','\xB5',
	'\xCF','\xB8','\xCF','\xBB','\xD1','\x90','\xD1','\x91','\xD1','\x92',
	'\xD1','\x93','\xD1','\x94','\xD1','\x95','\xD1','\x96','\xD1','\x97',
	'\xD1','\x98','\xD1','\x99','\xD1','\x9A','\xD1','\x9B','\xD1','\x9C',
	'\xD1','\x9D','\xD1','\x9E','\xD1','\x9F','\xD0','\xB0','\xD0','\xB1',
	'\xD0','\xB2','\xD0','\xB3','\xD0','\xB4','\xD0','\xB5','\xD0','\xB6',
	'\xD0','\xB7','\xD0','\xB8','\xD0','\xB9','\xD0','\xBA','\xD0','\xBB',
	'\xD0','\xBC','\xD0','\xBD','\xD0','\xBE','\xD0','\xBF','\xD1','\x80',
	'\xD1','\x81','\xD1','\x82','\xD1','\x83','\xD1','\x84','\xD1','\x85',
	'\xD1','\x86','\xD1','\x87','\xD1','\x88','\xD1','\x89','\xD1','\x8A',
	'\xD1','\x8B','\xD1','\x8C','\xD1','\x8D','\xD1','\x8E','\xD1','\x8F',
	'\xD1','\xA1','\xD1','\xA3','\xD1','\xA5','\xD1','\xA7','\xD1','\xA9',
	'\xD1','\xAB','\xD1','\xAD','\xD1','\xAF','\xD1','\xB1','\xD1','\xB3',
	'\xD1','\xB5','\xD1','\xB7','\xD1','\xB9','\xD1','\xBB','\xD1','\xBD',
	'\xD1','\xBF','\xD2','\x81','\xD2','\x8B','\xD2','\x8D','\xD2','\x8F',
	'\xD2','\x91','\xD2','\x93','\xD2','\x95','\xD2','\x97','\xD2','\x99',
	'\xD2','\x9B','\xD2','\x9D','\xD2','\x9F','\xD2','\xA1','\xD2','\xA3',
	'\xD2','\xA5','\xD2','\xA7','\xD2','\xA9','\xD2','\xAB','\xD2','\xAD',
	'\xD2','\xAF','\xD2','\xB1','\xD2','\xB3','\xD2','\xB5','\xD2','\xB7',
	'\xD2','\xB9','\xD2','\xBB','\xD2','\xBD','\xD2','\xBF','\xD3','\x8F',
	'\xD3','\x82','\xD3','\x84','\xD3','\x86','\xD3','\x88','\xD3','\x8A',
	'\xD3','\x8C','\xD3','\x8E','\xD3','\x91','\xD3','\x93','\xD3','\x95',
	'\xD3','\x97','\xD3','\x99','\xD3','\x9B','\xD3','\x9D','\xD3','\x9F',
	'\xD3','\xA1','\xD3','\xA3','\xD3','\xA5','\xD3','\xA7','\xD3','\xA9',
	'\xD3','\xAB','\xD3','\xAD','\xD3','\xAF','\xD3','\xB1','\xD3','\xB3',
	'\xD3','\xB5','\xD3','\xB7','\xD3','\xB9','\xD3','\xBB','\xD3','\xBD',
	'\xD3','\xBF','\xD4','\x81','\xD4','\x83','\xD4','\x85','\xD4','\x87',
	'\xD4','\x89','\xD4','\x8B','\xD4','\x8D','\xD4','\x8F','\xD4','\x91',
	'\xD4','\x93','\xD4','\x95','\xD4','\x97','\xD4','\x99','\xD4','\x9B',
	'\xD4','\x9D','\xD4','\x9F','\xD4','\xA1','\xD4','\xA3','\xD4','\xA5',
	'\xD4','\xA7','\xD4','\xA9','\xD4','\xAB','\xD4','\xAD','\xD4','\xAF',
	'\xD5','\xA1','\xD5','\xA2','\xD5','\xA3','\xD5','\xA4','\xD5','\xA5',
	'\xD5','\xA6','\xD5','\xA7','\xD5','\xA8','\xD5','\xA9','\xD5','\xAA',
	'\xD5','\xAB','\xD5','\xAC','\xD5','\xAD','\xD5','\xAE','\xD5','\xAF',
	'\xD5','\xB0','\xD5','\xB1','\xD5','\xB2','\xD5','\xB3','\xD5','\xB4',
	'\xD5','\xB5','\xD5','\xB6','\xD5','\xB7','\xD5','\xB8','\xD5','\xB9',
	'\xD5','\xBA','\xD5','\xBB','\xD5','\xBC','\xD5','\xBD','\xD5','\xBE',
	'\xD5','\xBF','\xD6','\x80','\xD6','\x81','\xD6','\x82','\xD6','\x83',
	'\xD6','\x84','\xD6','\x85','\xD6','\x86','\xD6','\x87',255   ,255   ,
	'\xE2','\xB4','\x80','\xE2','\xB4','\x81','\xE2','\xB4','\x82','\xE2',
	'\xB4','\x83','\xE2','\xB4','\x84','\xE2','\xB4','\x85','\xE2','\xB4',
	'\x86','\xE2','\xB4','\x87','\xE2','\xB4','\x88','\xE2','\xB4','\x89',
	'\xE2','\xB4','\x8A','\xE2','\xB4','\x8B','\xE2','\xB4','\x8C','\xE2',
	'\xB4','\x8D','\xE2','\xB4','\x8E','\xE2','\xB4','\x8F','\xE2','\xB4',
	'\x90','\xE2','\xB4','\x91','\xE2','\xB4','\x92','\xE2','\xB4','\x93',
	'\xE2','\xB4','\x94','\xE2','\xB4','\x95','\xE2','\xB4','\x96','\xE2',
	'\xB4','\x97','\xE2','\xB4','\x98','\xE2','\xB4','\x99','\xE2','\xB4',
	'\x9A','\xE2','\xB4','\x9B','\xE2','\xB4','\x9C','\xE2','\xB4','\x9D',
	'\xE2','\xB4','\x9E','\xE2','\xB4','\x9F','\xE2','\xB4','\xA0','\xE2',
	'\xB4','\xA1','\xE2','\xB4','\xA2','\xE2','\xB4','\xA3','\xE2','\xB4',
	'\xA4','\xE2','\xB4','\xA5','\xE2','\xB4','\xA7','\xE2','\xB4','\xAD',
	'\xE1','\xB5','\xB9','\xE1','\xB5','\xBD','\xE1','\xB8','\x81','\xE1',
	'\xB8','\x83','\xE1','\xB8','\x85','\xE1','\xB8','\x87','\xE1','\xB8',
	'\x89','\xE1','\xB8','\x8B','\xE1','\xB8','\x8D','\xE1','\xB8','\x8F',
	'\xE1','\xB8','\x91','\xE1','\xB8','\x93','\xE1','\xB8','\x95','\xE1',
	'\xB8','\x97','\xE1','\xB8','\x99','\xE1','\xB8','\x9B','\xE1','\xB8',
	'\x9D','\xE1','\xB8','\x9F','\xE1','\xB8','\xA1','\xE1','\xB8','\xA3',
	'\xE1','\xB8','\xA5','\xE1','\xB8','\xA7','\xE1','\xB8','\xA9','\xE1',
	'\xB8','\xAB','\xE1','\xB8','\xAD','\xE1','\xB8','\xAF','\xE1','\xB8',
	'\xB1','\xE1','\xB8','\xB3','\xE1','\xB8','\xB5','\xE1','\xB8','\xB7',
	'\xE1','\xB8','\xB9','\xE1','\xB8','\xBB','\xE1','\xB8','\xBD','\xE1',
	'\xB8','\xBF','\xE1','\xB9','\x81','\xE1','\xB9','\x83','\xE1','\xB9',
	'\x85','\xE1','\xB9','\x87','\xE1','\xB9','\x89','\xE1','\xB9','\x8B',
	'\xE1','\xB9','\x8D','\xE1','\xB9','\x8F','\xE1','\xB9','\x91','\xE1',
	'\xB9','\x93','\xE1','\xB9','\x95','\xE1','\xB9','\x97','\xE1','\xB9',
	'\x99','\xE1','\xB9','\x9B','\xE1','\xB9','\x9D','\xE1','\xB9','\x9F',
	'\xE1','\xB9','\xA1','\xE1','\xB9','\xA3','\xE1','\xB9','\xA5','\xE1',
	'\xB9','\xA7','\xE1','\xB9','\xA9','\xE1','\xB9','\xAB','\xE1','\xB9',
	'\xAD','\xE1','\xB9','\xAF','\xE1','\xB9','\xB1','\xE1','\xB9','\xB3',
	'\xE1','\xB9','\xB5','\xE1','\xB9','\xB7','\xE1','\xB9','\xB9','\xE1',
	'\xB9','\xBB','\xE1','\xB9','\xBD','\xE1','\xB9','\xBF','\xE1','\xBA',
	'\x81','\xE1','\xBA','\x83','\xE1','\xBA','\x85','\xE1','\xBA','\x87',
	'\xE1','\xBA','\x89','\xE1','\xBA','\x8B','\xE1','\xBA','\x8D','\xE1',
	'\xBA','\x8F','\xE1','\xBA','\x91','\xE1','\xBA','\x93','\xE1','\xBA',
	'\x95','\xE1','\xBA','\x96','\xE1','\xBA','\x97','\xE1','\xBA','\x98',
	'\xE1','\xBA','\x99','\xE1','\xBA','\x9A','\xE1','\xBA','\x9B','\xC3',
	'\x9F',255   ,'\xE1','\xBA','\xA1','\xE1','\xBA','\xA3','\xE1','\xBA',
	'\xA5','\xE1','\xBA','\xA7','\xE1','\xBA','\xA9','\xE1','\xBA','\xAB',
	'\xE1','\xBA','\xAD','\xE1','\xBA','\xAF','\xE1','\xBA','\xB1','\xE1',
	'\xBA','\xB3','\xE1','\xBA','\xB5','\xE1','\xBA','\xB7','\xE1','\xBA',
	'\xB9','\xE1','\xBA','\xBB','\xE1','\xBA','\xBD','\xE1','\xBA','\xBF',
	'\xE1','\xBB','\x81','\xE1','\xBB','\x83','\xE1','\xBB','\x85','\xE1',
	'\xBB','\x87','\xE1','\xBB','\x89','\xE1','\xBB','\x8B','\xE1','\xBB',
	'\x8D','\xE1','\xBB','\x8F','\xE1','\xBB','\x91','\xE1','\xBB','\x93',
	'\xE1','\xBB','\x95','\xE1','\xBB','\x97','\xE1','\xBB','\x99','\xE1',
	'\xBB','\x9B','\xE1','\xBB','\x9D','\xE1','\xBB','\x9F','\xE1','\xBB',
	'\xA1','\xE1','\xBB','\xA3','\xE1','\xBB','\xA5','\xE1','\xBB','\xA7',
	'\xE1','\xBB','\xA9','\xE1','\xBB','\xAB','\xE1','\xBB','\xAD','\xE1',
	'\xBB','\xAF','\xE1','\xBB','\xB1','\xE1','\xBB','\xB3','\xE1','\xBB',
	'\xB5','\xE1','\xBB','\xB7','\xE1','\xBB','\xB9','\xE1','\xBB','\xBB',
	'\xE1','\xBB','\xBD','\xE1','\xBB','\xBF','\xE1','\xBC','\x80','\xE1',
	'\xBC','\x81','\xE1','\xBC','\x82','\xE1','\xBC','\x83','\xE1','\xBC',
	'\x84','\xE1','\xBC','\x85','\xE1','\xBC','\x86','\xE1','\xBC','\x87',
	'\xE1','\xBC','\x90','\xE1','\xBC','\x91','\xE1','\xBC','\x92','\xE1',
	'\xBC','\x93','\xE1','\xBC','\x94','\xE1','\xBC','\x95','\xE1','\xBC',
	'\xA0','\xE1','\xBC','\xA1','\xE1','\xBC','\xA2','\xE1','\xBC','\xA3',
	'\xE1','\xBC','\xA4','\xE1','\xBC','\xA5','\xE1','\xBC','\xA6','\xE1',
	'\xBC','\xA7','\xE1','\xBC','\xB0','\xE1','\xBC','\xB1','\xE1','\xBC',
	'\xB2','\xE1','\xBC','\xB3','\xE1','\xBC','\xB4','\xE1','\xBC','\xB5',
	'\xE1','\xBC','\xB6','\xE1','\xBC','\xB7','\xE1','\xBD','\x80','\xE1',
	'\xBD','\x81','\xE1','\xBD','\x82','\xE1','\xBD','\x83','\xE1','\xBD',
	'\x84','\xE1','\xBD','\x85','\xE1','\xBD','\x90',255   ,'\xE1','\xBD',
	'\x91','\xE1','\xBD','\x92',255   ,255   ,255   ,'\xE1','\xBD','\x93',
	'\xE1','\xBD','\x94',255   ,255   ,255   ,'\xE1','\xBD','\x95','\xE1',
	'\xBD','\x96',255   ,255   ,255   ,'\xE1','\xBD','\x97','\xE1','\xBD',
	'\xA0','\xE1','\xBD','\xA1','\xE1','\xBD','\xA2','\xE1','\xBD','\xA3',
	'\xE1','\xBD','\xA4','\xE1','\xBD','\xA5','\xE1','\xBD','\xA6','\xE1',
	'\xBD','\xA7','\xE1','\xBD','\xB0','\xE1','\xBD','\xB1','\xE1','\xBD',
	'\xB2','\xE1','\xBD','\xB3','\xE1','\xBD','\xB4','\xE1','\xBD','\xB5',
	'\xE1','\xBD','\xB6','\xE1','\xBD','\xB7','\xE1','\xBD','\xB8','\xE1',
	'\xBD','\xB9','\xE1','\xBD','\xBA','\xE1','\xBD','\xBB','\xE1','\xBD',
	'\xBC','\xE1','\xBD','\xBD','\xE1','\xBE','\x80',255   ,255   ,'\xE1',
	'\xBE','\x81',255   ,255   ,'\xE1','\xBE','\x82',255   ,255   ,'\xE1',
	'\xBE','\x83',255   ,255   ,'\xE1','\xBE','\x84',255   ,255   ,'\xE1',
	'\xBE','\x85',255   ,255   ,'\xE1','\xBE','\x86',255   ,255   ,'\xE1',
	'\xBE','\x87',255   ,255   ,'\xE1','\xBE','\x90',255   ,255   ,'\xE1',
	'\xBE','\x91',255   ,255   ,'\xE1','\xBE','\x92',255   ,255   ,'\xE1',
	'\xBE','\x93',255   ,255   ,'\xE1','\xBE','\x94',255   ,255   ,'\xE1',
	'\xBE','\x95',255   ,255   ,'\xE1','\xBE','\x96',255   ,255   ,'\xE1',
	'\xBE','\x97',255   ,255   ,'\xE1','\xBE','\xA0',255   ,255   ,'\xE1',
	'\xBE','\xA1',255   ,255   ,'\xE1','\xBE','\xA2',255   ,255   ,'\xE1',
	'\xBE','\xA3',255   ,255   ,'\xE1','\xBE','\xA4',255   ,255   ,'\xE1',
	'\xBE','\xA5',255   ,255   ,'\xE1','\xBE','\xA6',255   ,255   ,'\xE1',
	'\xBE','\xA7',255   ,255   ,'\xE1','\xBE','\xB0','\xE1','\xBE','\xB1',
	'\xE1','\xBE','\xB2',255   ,255   ,'\xE1','\xBE','\xB3',255   ,'\xE1',
	'\xBE','\xB4',255   ,'\xE1','\xBE','\xB6',255   ,'\xE1','\xBE','\xB7',
	255   ,255   ,255   ,'\xE1','\xBE','\xBE','\xE1','\xBF','\x82',255   ,
	255   ,'\xE1','\xBF','\x83',255   ,'\xE1','\xBF','\x84',255   ,'\xE1',
	'\xBF','\x86',255   ,'\xE1','\xBF','\x87',255   ,255   ,255   ,'\xE1',
	'\xBF','\x90','\xE1','\xBF','\x91','\xE1','\xBF','\x92',255   ,255   ,
	255   ,'\xE1','\xBF','\x93',255   ,255   ,255   ,'\xE1','\xBF','\x96',
	255   ,'\xE1','\xBF','\x97',255   ,255   ,255   ,'\xE1','\xBF','\xA0',
	'\xE1','\xBF','\xA1','\xE1','\xBF','\xA2',255   ,255   ,255   ,'\xE1',
	'\xBF','\xA3',255   ,255   ,255   ,'\xE1','\xBF','\xA4',255   ,'\xE1',
	'\xBF','\xA5','\xE1','\xBF','\xA6',255   ,'\xE1','\xBF','\xA7',255   ,
	255   ,255   ,'\xE1','\xBF','\xB2',255   ,255   ,'\xE1','\xBF','\xB3',
	255   ,'\xE1','\xBF','\xB4',255   ,'\xE1','\xBF','\xB6',255   ,'\xE1',
	'\xBF','\xB7',255   ,255   ,255   ,'\xCF','\x89',255   ,'\x6b',255   ,
	255   ,'\xC3','\xA5',255   ,'\xE2','\x85','\x8E','\xE2','\x85','\xB0',
	'\xE2','\x85','\xB1','\xE2','\x85','\xB2','\xE2','\x85','\xB3','\xE2',
	'\x85','\xB4','\xE2','\x85','\xB5','\xE2','\x85','\xB6','\xE2','\x85',
	'\xB7','\xE2','\x85','\xB8','\xE2','\x85','\xB9','\xE2','\x85','\xBA',
	'\xE2','\x85','\xBB','\xE2','\x85','\xBC','\xE2','\x85','\xBD','\xE2',
	'\x85','\xBE','\xE2','\x85','\xBF','\xE2','\x86','\x84','\xE2','\x93',
	'\x90','\xE2','\x93','\x91','\xE2','\x93','\x92','\xE2','\x93','\x93',
	'\xE2','\x93','\x94','\xE2','\x93','\x95','\xE2','\x93','\x96','\xE2',
	'\x93','\x97','\xE2','\x93','\x98','\xE2','\x93','\x99','\xE2','\x93',
	'\x9A','\xE2','\x93','\x9B','\xE2','\x93','\x9C','\xE2','\x93','\x9D',
	'\xE2','\x93','\x9E','\xE2','\x93','\x9F','\xE2','\x93','\xA0','\xE2',
	'\x93','\xA1','\xE2','\x93','\xA2','\xE2','\x93','\xA3','\xE2','\x93',
	'\xA4','\xE2','\x93','\xA5','\xE2','\x93','\xA6','\xE2','\x93','\xA7',
	'\xE2','\x93','\xA8','\xE2','\x93','\xA9','\xE2','\xB0','\xB0','\xE2',
	'\xB0','\xB1','\xE2','\xB0','\xB2','\xE2','\xB0','\xB3','\xE2','\xB0',
	'\xB4','\xE2','\xB0','\xB5','\xE2','\xB0','\xB6','\xE2','\xB0','\xB7',
	'\xE2','\xB0','\xB8','\xE2','\xB0','\xB9','\xE2','\xB0','\xBA','\xE2',
	'\xB0','\xBB','\xE2','\xB0','\xBC','\xE2','\xB0','\xBD','\xE2','\xB0',
	'\xBE','\xE2','\xB0','\xBF','\xE2','\xB1','\x80','\xE2','\xB1','\x81',
	'\xE2','\xB1','\x82','\xE2','\xB1','\x83','\xE2','\xB1','\x84','\xE2',
	'\xB1','\x85','\xE2','\xB1','\x86','\xE2','\xB1','\x87','\xE2','\xB1',
	'\x88','\xE2','\xB1','\x89','\xE2','\xB1','\x8A','\xE2','\xB1','\x8B',
	'\xE2','\xB1','\x8C','\xE2','\xB1','\x8D','\xE2','\xB1','\x8E','\xE2',
	'\xB1','\x8F','\xE2','\xB1','\x90','\xE2','\xB1','\x91','\xE2','\xB1',
	'\x92','\xE2','\xB1','\x93','\xE2','\xB1','\x94','\xE2','\xB1','\x95',
	'\xE2','\xB1','\x96','\xE2','\xB1','\x97','\xE2','\xB1','\x98','\xE2',
	'\xB1','\x99','\xE2','\xB1','\x9A','\xE2','\xB1','\x9B','\xE2','\xB1',
	'\x9C','\xE2','\xB1','\x9D','\xE2','\xB1','\x9E','\xE2','\xB1','\xA1',
	'\xE2','\xB1','\xA8','\xE2','\xB1','\xAA','\xE2','\xB1','\xAC','\xE2',
	'\xB1','\xB3','\xE2','\xB1','\xB6','\xE2','\xB2','\x81','\xE2','\xB2',
	'\x83','\xE2','\xB2','\x85','\xE2','\xB2','\x87','\xE2','\xB2','\x89',
	'\xE2','\xB2','\x8B','\xE2','\xB2','\x8D','\xE2','\xB2','\x8F','\xE2',
	'\xB2','\x91','\xE2','\xB2','\x93','\xE2','\xB2','\x95','\xE2','\xB2',
	'\x97','\xE2','\xB2','\x99','\xE2','\xB2','\x9B','\xE2','\xB2','\x9D',
	'\xE2','\xB2','\x9F','\xE2','\xB2','\xA1','\xE2','\xB2','\xA3','\xE2',
	'\xB2','\xA5','\xE2','\xB2','\xA7','\xE2','\xB2','\xA9','\xE2','\xB2',
	'\xAB','\xE2','\xB2','\xAD','\xE2','\xB2','\xAF','\xE2','\xB2','\xB1',
	'\xE2','\xB2','\xB3','\xE2','\xB2','\xB5','\xE2','\xB2','\xB7','\xE2',
	'\xB2','\xB9','\xE2','\xB2','\xBB','\xE2','\xB2','\xBD','\xE2','\xB2',
	'\xBF','\xE2','\xB3','\x81','\xE2','\xB3','\x83','\xE2','\xB3','\x85',
	'\xE2','\xB3','\x87','\xE2','\xB3','\x89','\xE2','\xB3','\x8B','\xE2',
	'\xB3','\x8D','\xE2','\xB3','\x8F','\xE2','\xB3','\x91','\xE2','\xB3',
	'\x93','\xE2','\xB3','\x95','\xE2','\xB3','\x97','\xE2','\xB3','\x99',
	'\xE2','\xB3','\x9B','\xE2','\xB3','\x9D','\xE2','\xB3','\x9F','\xE2',
	'\xB3','\xA1','\xE2','\xB3','\xA3','\xE2','\xB3','\xAC','\xE2','\xB3',
	'\xAE','\xE2','\xB3','\xB3','\xEA','\x99','\x81','\xEA','\x99','\x83',
	'\xEA','\x99','\x85','\xEA','\x99','\x87','\xEA','\x99','\x89','\xEA',
	'\x99','\x8B','\xEA','\x99','\x8D','\xEA','\x99','\x8F','\xEA','\x99',
	'\x91','\xEA','\x99','\x93','\xEA','\x99','\x95','\xEA','\x99','\x97',
	'\xEA','\x99','\x99','\xEA','\x99','\x9B','\xEA','\x99','\x9D','\xEA',
	'\x99','\x9F','\xEA','\x99','\xA1','\xEA','\x99','\xA3','\xEA','\x99',
	'\xA5','\xEA','\x99','\xA7','\xEA','\x99','\xA9','\xEA','\x99','\xAB',
	'\xEA','\x99','\xAD','\xEA','\x9A','\x81','\xEA','\x9A','\x83','\xEA',
	'\x9A','\x85','\xEA','\x9A','\x87','\xEA','\x9A','\x89','\xEA','\x9A',
	'\x8B','\xEA','\x9A','\x8D','\xEA','\x9A','\x8F','\xEA','\x9A','\x91',
	'\xEA','\x9A','\x93','\xEA','\x9A','\x95','\xEA','\x9A','\x97','\xEA',
	'\x9A','\x99','\xEA','\x9A','\x9B','\xEA','\x9C','\xA3','\xEA','\x9C',
	'\xA5','\xEA','\x9C','\xA7','\xEA','\x9C','\xA9','\xEA','\x9C','\xAB',
	'\xEA','\x9C','\xAD','\xEA','\x9C','\xAF','\xEA','\x9C','\xB3','\xEA',
	'\x9C','\xB5','\xEA','\x9C','\xB7','\xEA','\x9C','\xB9','\xEA','\x9C',
	'\xBB','\xEA','\x9C','\xBD','\xEA','\x9C','\xBF','\xEA','\x9D','\x81',
	'\xEA','\x9D','\x83','\xEA','\x9D','\x85','\xEA','\x9D','\x87','\xEA',
	'\x9D','\x89','\xEA','\x9D','\x8B','\xEA','\x9D','\x8D','\xEA','\x9D',
	'\x8F','\xEA','\x9D','\x91','\xEA','\x9D','\x93','\xEA','\x9D','\x95',
	'\xEA','\x9D','\x97','\xEA','\x9D','\x99','\xEA','\x9D','\x9B','\xEA',
	'\x9D','\x9D','\xEA','\x9D','\x9F','\xEA','\x9D','\xA1','\xEA','\x9D',
	'\xA3','\xEA','\x9D','\xA5','\xEA','\x9D','\xA7','\xEA','\x9D','\xA9',
	'\xEA','\x9D','\xAB','\xEA','\x9D','\xAD','\xEA','\x9D','\xAF','\xEA',
	'\x9D','\xBA','\xEA','\x9D','\xBC','\xEA','\x9D','\xBF','\xEA','\x9E',
	'\x81','\xEA','\x9E','\x83','\xEA','\x9E','\x85','\xEA','\x9E','\x87',
	'\xEA','\x9E','\x8C','\xEA','\x9E','\x91','\xEA','\x9E','\x93','\xEA',
	'\x9E','\x97','\xEA','\x9E','\x99','\xEA','\x9E','\x9B','\xEA','\x9E',
	'\x9D','\xEA','\x9E','\x9F','\xEA','\x9E','\xA1','\xEA','\x9E','\xA3',
	'\xEA','\x9E','\xA5','\xEA','\x9E','\xA7','\xEA','\x9E','\xA9','\xEF',
	'\xAC','\x80','\xEF','\xAC','\x81','\xEF','\xAC','\x82','\xEF','\xAC',
	'\x83','\xEF','\xAC','\x84','\xEF','\xAC','\x85','\xEF','\xAC','\x86',
	'\xEF','\xAC','\x93',255   ,'\xEF','\xAC','\x94',255   ,'\xEF','\xAC',
	'\x95',255   ,'\xEF','\xAC','\x96',255   ,'\xEF','\xAC','\x97',255   ,
	'\xEF','\xBD','\x81','\xEF','\xBD','\x82','\xEF','\xBD','\x83','\xEF',
	'\xBD','\x84','\xEF','\xBD','\x85','\xEF','\xBD','\x86','\xEF','\xBD',
	'\x87','\xEF','\xBD','\x88','\xEF','\xBD','\x89','\xEF','\xBD','\x8A',
	'\xEF','\xBD','\x8B','\xEF','\xBD','\x8C','\xEF','\xBD','\x8D','\xEF',
	'\xBD','\x8E','\xEF','\xBD','\x8F','\xEF','\xBD','\x90','\xEF','\xBD',
	'\x91','\xEF','\xBD','\x92','\xEF','\xBD','\x93','\xEF','\xBD','\x94',
	'\xEF','\xBD','\x95','\xEF','\xBD','\x96','\xEF','\xBD','\x97','\xEF',
	'\xBD','\x98','\xEF','\xBD','\x99','\xEF','\xBD','\x9A',
	0
};

static const char uppers[] = {
	'\x41','\x42','\x43','\x44','\x45','\x46','\x47','\x48','\x49','\x4a',
	'\x4b','\x4c','\x4d','\x4e','\x4f','\x50','\x51','\x52','\x53','\x54',
	'\x55','\x56','\x57','\x58','\x59','\x5a','\xCE','\x9C','\xC3','\x80',
	'\xC3','\x81','\xC3','\x82','\xC3','\x83','\xC3','\x84','\xC3','\x85',
	'\xC3','\x86','\xC3','\x87','\xC3','\x88','\xC3','\x89','\xC3','\x8A',
	'\xC3','\x8B','\xC3','\x8C','\xC3','\x8D','\xC3','\x8E','\xC3','\x8F',
	'\xC3','\x90','\xC3','\x91','\xC3','\x92','\xC3','\x93','\xC3','\x94',
	'\xC3','\x95','\xC3','\x96','\xC3','\x98','\xC3','\x99','\xC3','\x9A',
	'\xC3','\x9B','\xC3','\x9C','\xC3','\x9D','\xC3','\x9E','\x53','\x53',
	'\xC5','\xB8','\xC4','\x80','\xC4','\x82','\xC4','\x84','\xC4','\x86',
	'\xC4','\x88','\xC4','\x8A','\xC4','\x8C','\xC4','\x8E','\xC4','\x90',
	'\xC4','\x92','\xC4','\x94','\xC4','\x96','\xC4','\x98','\xC4','\x9A',
	'\xC4','\x9C','\xC4','\x9E','\xC4','\xA0','\xC4','\xA2','\xC4','\xA4',
	'\xC4','\xA6','\xC4','\xA8','\xC4','\xAA','\xC4','\xAC','\xC4','\xAE',
	'\xC4','\xB0',255   ,'\x49',255   ,'\xC4','\xB2','\xC4','\xB4','\xC4',
	'\xB6','\xC4','\xB9','\xC4','\xBB','\xC4','\xBD','\xC4','\xBF','\xC5',
	'\x81','\xC5','\x83','\xC5','\x85','\xC5','\x87','\xCA','\xBC','\x4e',
	'\xC5','\x8A','\xC5','\x8C','\xC5','\x8E','\xC5','\x90','\xC5','\x92',
	'\xC5','\x94','\xC5','\x96','\xC5','\x98','\xC5','\x9A','\xC5','\x9C',
	'\xC5','\x9E','\xC5','\xA0','\xC5','\xA2','\xC5','\xA4','\xC5','\xA6',
	'\xC5','\xA8','\xC5','\xAA','\xC5','\xAC','\xC5','\xAE','\xC5','\xB0',
	'\xC5','\xB2','\xC5','\xB4','\xC5','\xB6','\xC5','\xB9','\xC5','\xBB',
	'\xC5','\xBD','\x53',255   ,'\xC9','\x83','\xC6','\x81','\xC6','\x82',
	'\xC6','\x84','\xC6','\x86','\xC6','\x87','\xC6','\x89','\xC6','\x8A',
	'\xC6','\x8B','\xC6','\x8E','\xC6','\x8F','\xC6','\x90','\xC6','\x91',
	'\xC6','\x93','\xC6','\x94','\xC7','\xB6','\xC6','\x96','\xC6','\x97',
	'\xC6','\x98','\xC8','\xBD','\xC6','\x9C','\xC6','\x9D','\xC8','\xA0',
	'\xC6','\x9F','\xC6','\xA0','\xC6','\xA2','\xC6','\xA4','\xC6','\xA6',
	'\xC6','\xA7','\xC6','\xA9','\xC6','\xAC','\xC6','\xAE','\xC6','\xAF',
	'\xC6','\xB1','\xC6','\xB2','\xC6','\xB3','\xC6','\xB5','\xC6','\xB7',
	'\xC6','\xB8','\xC6','\xBC','\xC7','\xB7','\xC7','\x84','\xC7','\x87',
	'\xC7','\x8A','\xC7','\x8D','\xC7','\x8F','\xC7','\x91','\xC7','\x93',
	'\xC7','\x95','\xC7','\x97','\xC7','\x99','\xC7','\x9B','\xC7','\x9E',
	'\xC7','\xA0','\xC7','\xA2','\xC7','\xA4','\xC7','\xA6','\xC7','\xA8',
	'\xC7','\xAA','\xC7','\xAC','\xC7','\xAE','\x4a','\xCC','\x8C','\xC7',
	'\xB1','\xC7','\xB4','\xC7','\xB8','\xC7','\xBA','\xC7','\xBC','\xC7',
	'\xBE','\xC8','\x80','\xC8','\x82','\xC8','\x84','\xC8','\x86','\xC8',
	'\x88','\xC8','\x8A','\xC8','\x8C','\xC8','\x8E','\xC8','\x90','\xC8',
	'\x92','\xC8','\x94','\xC8','\x96','\xC8','\x98','\xC8','\x9A','\xC8',
	'\x9C','\xC8','\x9E','\xC8','\xA2','\xC8','\xA4','\xC8','\xA6','\xC8',
	'\xA8','\xC8','\xAA','\xC8','\xAC','\xC8','\xAE','\xC8','\xB0','\xC8',
	'\xB2','\xC8','\xBA',255   ,'\xC8','\xBB','\xC8','\xBE',255   ,'\xE2',
	'\xB1','\xBE','\xE2','\xB1','\xBF','\xC9','\x81','\xC9','\x84','\xC9',
	'\x85','\xC9','\x86','\xC9','\x88','\xC9','\x8A','\xC9','\x8C','\xC9',
	'\x8E','\xE2','\xB1','\xAF','\xE2','\xB1','\xAD','\xE2','\xB1','\xB0',
	'\xEA','\x9E','\xAB','\xEA','\x9E','\xAC','\xEA','\x9E','\x8D','\xEA',
	'\x9E','\xAA','\xE2','\xB1','\xA2','\xEA','\x9E','\xAD','\xE2','\xB1',
	'\xAE','\xE2','\xB1','\xA4','\xEA','\x9E','\xB1','\xEA','\x9E','\xB0',
	'\xCE','\x99','\xCD','\xB0','\xCD','\xB2','\xCD','\xB6','\xCF','\xBD',
	'\xCF','\xBE','\xCF','\xBF','\xCD','\xBF','\xCE','\x86','\xCE','\x88',
	'\xCE','\x89','\xCE','\x8A','\xCE','\x8C','\xCE','\x8E','\xCE','\x8F',
	'\xCE','\x99','\xCC','\x88','\xCC','\x81','\xCE','\x91','\xCE','\x92',
	'\xCE','\x93','\xCE','\x94','\xCE','\x95','\xCE','\x96','\xCE','\x97',
	'\xCE','\x98','\xCE','\x99','\xCE','\x9A','\xCE','\x9B','\xCE','\x9C',
	'\xCE','\x9D','\xCE','\x9E','\xCE','\x9F','\xCE','\xA0','\xCE','\xA1',
	'\xCE','\xA3','\xCE','\xA4','\xCE','\xA5','\xCE','\xA6','\xCE','\xA7',
	'\xCE','\xA8','\xCE','\xA9','\xCE','\xAA','\xCE','\xAB','\xCE','\xA5',
	'\xCC','\x88','\xCC','\x81','\xCE','\xA3','\xCF','\x8F','\xCE','\x92',
	'\xCE','\x98','\xCE','\xA6','\xCE','\xA0','\xCF','\x98','\xCF','\x9A',
	'\xCF','\x9C','\xCF','\x9E','\xCF','\xA0','\xCF','\xA2','\xCF','\xA4',
	'\xCF','\xA6','\xCF','\xA8','\xCF','\xAA','\xCF','\xAC','\xCF','\xAE',
	'\xCE','\x9A','\xCE','\xA1','\xCF','\xB9','\xCF','\xB4','\xCE','\x95',
	'\xCF','\xB7','\xCF','\xBA','\xD0','\x80','\xD0','\x81','\xD0','\x82',
	'\xD0','\x83','\xD0','\x84','\xD0','\x85','\xD0','\x86','\xD0','\x87',
	'\xD0','\x88','\xD0','\x89','\xD0','\x8A','\xD0','\x8B','\xD0','\x8C',
	'\xD0','\x8D','\xD0','\x8E','\xD0','\x8F','\xD0','\x90','\xD0','\x91',
	'\xD0','\x92','\xD0','\x93','\xD0','\x94','\xD0','\x95','\xD0','\x96',
	'\xD0','\x97','\xD0','\x98','\xD0','\x99','\xD0','\x9A','\xD0','\x9B',
	'\xD0','\x9C','\xD0','\x9D','\xD0','\x9E','\xD0','\x9F','\xD0','\xA0',
	'\xD0','\xA1','\xD0','\xA2','\xD0','\xA3','\xD0','\xA4','\xD0','\xA5',
	'\xD0','\xA6','\xD0','\xA7','\xD0','\xA8','\xD0','\xA9','\xD0','\xAA',
	'\xD0','\xAB','\xD0','\xAC','\xD0','\xAD','\xD0','\xAE','\xD0','\xAF',
	'\xD1','\xA0','\xD1','\xA2','\xD1','\xA4','\xD1','\xA6','\xD1','\xA8',
	'\xD1','\xAA','\xD1','\xAC','\xD1','\xAE','\xD1','\xB0','\xD1','\xB2',
	'\xD1','\xB4','\xD1','\xB6','\xD1','\xB8','\xD1','\xBA','\xD1','\xBC',
	'\xD1','\xBE','\xD2','\x80','\xD2','\x8A','\xD2','\x8C','\xD2','\x8E',
	'\xD2','\x90','\xD2','\x92','\xD2','\x94','\xD2','\x96','\xD2','\x98',
	'\xD2','\x9A','\xD2','\x9C','\xD2','\x9E','\xD2','\xA0','\xD2','\xA2',
	'\xD2','\xA4','\xD2','\xA6','\xD2','\xA8','\xD2','\xAA','\xD2','\xAC',
	'\xD2','\xAE','\xD2','\xB0','\xD2','\xB2','\xD2','\xB4','\xD2','\xB6',
	'\xD2','\xB8','\xD2','\xBA','\xD2','\xBC','\xD2','\xBE','\xD3','\x80',
	'\xD3','\x81','\xD3','\x83','\xD3','\x85','\xD3','\x87','\xD3','\x89',
	'\xD3','\x8B','\xD3','\x8D','\xD3','\x90','\xD3','\x92','\xD3','\x94',
	'\xD3','\x96','\xD3','\x98','\xD3','\x9A','\xD3','\x9C','\xD3','\x9E',
	'\xD3','\xA0','\xD3','\xA2','\xD3','\xA4','\xD3','\xA6','\xD3','\xA8',
	'\xD3','\xAA','\xD3','\xAC','\xD3','\xAE','\xD3','\xB0','\xD3','\xB2',
	'\xD3','\xB4','\xD3','\xB6','\xD3','\xB8','\xD3','\xBA','\xD3','\xBC',
	'\xD3','\xBE','\xD4','\x80','\xD4','\x82','\xD4','\x84','\xD4','\x86',
	'\xD4','\x88','\xD4','\x8A','\xD4','\x8C','\xD4','\x8E','\xD4','\x90',
	'\xD4','\x92','\xD4','\x94','\xD4','\x96','\xD4','\x98','\xD4','\x9A',
	'\xD4','\x9C','\xD4','\x9E','\xD4','\xA0','\xD4','\xA2','\xD4','\xA4',
	'\xD4','\xA6','\xD4','\xA8','\xD4','\xAA','\xD4','\xAC','\xD4','\xAE',
	'\xD4','\xB1','\xD4','\xB2','\xD4','\xB3','\xD4','\xB4','\xD4','\xB5',
	'\xD4','\xB6','\xD4','\xB7','\xD4','\xB8','\xD4','\xB9','\xD4','\xBA',
	'\xD4','\xBB','\xD4','\xBC','\xD4','\xBD','\xD4','\xBE','\xD4','\xBF',
	'\xD5','\x80','\xD5','\x81','\xD5','\x82','\xD5','\x83','\xD5','\x84',
	'\xD5','\x85','\xD5','\x86','\xD5','\x87','\xD5','\x88','\xD5','\x89',
	'\xD5','\x8A','\xD5','\x8B','\xD5','\x8C','\xD5','\x8D','\xD5','\x8E',
	'\xD5','\x8F','\xD5','\x90','\xD5','\x91','\xD5','\x92','\xD5','\x93',
	'\xD5','\x94','\xD5','\x95','\xD5','\x96','\xD4','\xB5','\xD5','\x92',
	'\xE1','\x82','\xA0','\xE1','\x82','\xA1','\xE1','\x82','\xA2','\xE1',
	'\x82','\xA3','\xE1','\x82','\xA4','\xE1','\x82','\xA5','\xE1','\x82',
	'\xA6','\xE1','\x82','\xA7','\xE1','\x82','\xA8','\xE1','\x82','\xA9',
	'\xE1','\x82','\xAA','\xE1','\x82','\xAB','\xE1','\x82','\xAC','\xE1',
	'\x82','\xAD','\xE1','\x82','\xAE','\xE1','\x82','\xAF','\xE1','\x82',
	'\xB0','\xE1','\x82','\xB1','\xE1','\x82','\xB2','\xE1','\x82','\xB3',
	'\xE1','\x82','\xB4','\xE1','\x82','\xB5','\xE1','\x82','\xB6','\xE1',
	'\x82','\xB7','\xE1','\x82','\xB8','\xE1','\x82','\xB9','\xE1','\x82',
	'\xBA','\xE1','\x82','\xBB','\xE1','\x82','\xBC','\xE1','\x82','\xBD',
	'\xE1','\x82','\xBE','\xE1','\x82','\xBF','\xE1','\x83','\x80','\xE1',
	'\x83','\x81','\xE1','\x83','\x82','\xE1','\x83','\x83','\xE1','\x83',
	'\x84','\xE1','\x83','\x85','\xE1','\x83','\x87','\xE1','\x83','\x8D',
	'\xEA','\x9D','\xBD','\xE2','\xB1','\xA3','\xE1','\xB8','\x80','\xE1',
	'\xB8','\x82','\xE1','\xB8','\x84','\xE1','\xB8','\x86','\xE1','\xB8',
	'\x88','\xE1','\xB8','\x8A','\xE1','\xB8','\x8C','\xE1','\xB8','\x8E',
	'\xE1','\xB8','\x90','\xE1','\xB8','\x92','\xE1','\xB8','\x94','\xE1',
	'\xB8','\x96','\xE1','\xB8','\x98','\xE1','\xB8','\x9A','\xE1','\xB8',
	'\x9C','\xE1','\xB8','\x9E','\xE1','\xB8','\xA0','\xE1','\xB8','\xA2',
	'\xE1','\xB8','\xA4','\xE1','\xB8','\xA6','\xE1','\xB8','\xA8','\xE1',
	'\xB8','\xAA','\xE1','\xB8','\xAC','\xE1','\xB8','\xAE','\xE1','\xB8',
	'\xB0','\xE1','\xB8','\xB2','\xE1','\xB8','\xB4','\xE1','\xB8','\xB6',
	'\xE1','\xB8','\xB8','\xE1','\xB8','\xBA','\xE1','\xB8','\xBC','\xE1',
	'\xB8','\xBE','\xE1','\xB9','\x80','\xE1','\xB9','\x82','\xE1','\xB9',
	'\x84','\xE1','\xB9','\x86','\xE1','\xB9','\x88','\xE1','\xB9','\x8A',
	'\xE1','\xB9','\x8C','\xE1','\xB9','\x8E','\xE1','\xB9','\x90','\xE1',
	'\xB9','\x92','\xE1','\xB9','\x94','\xE1','\xB9','\x96','\xE1','\xB9',
	'\x98','\xE1','\xB9','\x9A','\xE1','\xB9','\x9C','\xE1','\xB9','\x9E',
	'\xE1','\xB9','\xA0','\xE1','\xB9','\xA2','\xE1','\xB9','\xA4','\xE1',
	'\xB9','\xA6','\xE1','\xB9','\xA8','\xE1','\xB9','\xAA','\xE1','\xB9',
	'\xAC','\xE1','\xB9','\xAE','\xE1','\xB9','\xB0','\xE1','\xB9','\xB2',
	'\xE1','\xB9','\xB4','\xE1','\xB9','\xB6','\xE1','\xB9','\xB8','\xE1',
	'\xB9','\xBA','\xE1','\xB9','\xBC','\xE1','\xB9','\xBE','\xE1','\xBA',
	'\x80','\xE1','\xBA','\x82','\xE1','\xBA','\x84','\xE1','\xBA','\x86',
	'\xE1','\xBA','\x88','\xE1','\xBA','\x8A','\xE1','\xBA','\x8C','\xE1',
	'\xBA','\x8E','\xE1','\xBA','\x90','\xE1','\xBA','\x92','\xE1','\xBA',
	'\x94','\x48','\xCC','\xB1','\x54','\xCC','\x88','\x57','\xCC','\x8A',
	'\x59','\xCC','\x8A','\x41','\xCA','\xBE','\xE1','\xB9','\xA0','\xE1',
	'\xBA','\x9E','\xE1','\xBA','\xA0','\xE1','\xBA','\xA2','\xE1','\xBA',
	'\xA4','\xE1','\xBA','\xA6','\xE1','\xBA','\xA8','\xE1','\xBA','\xAA',
	'\xE1','\xBA','\xAC','\xE1','\xBA','\xAE','\xE1','\xBA','\xB0','\xE1',
	'\xBA','\xB2','\xE1','\xBA','\xB4','\xE1','\xBA','\xB6','\xE1','\xBA',
	'\xB8','\xE1','\xBA','\xBA','\xE1','\xBA','\xBC','\xE1','\xBA','\xBE',
	'\xE1','\xBB','\x80','\xE1','\xBB','\x82','\xE1','\xBB','\x84','\xE1',
	'\xBB','\x86','\xE1','\xBB','\x88','\xE1','\xBB','\x8A','\xE1','\xBB',
	'\x8C','\xE1','\xBB','\x8E','\xE1','\xBB','\x90','\xE1','\xBB','\x92',
	'\xE1','\xBB','\x94','\xE1','\xBB','\x96','\xE1','\xBB','\x98','\xE1',
	'\xBB','\x9A','\xE1','\xBB','\x9C','\xE1','\xBB','\x9E','\xE1','\xBB',
	'\xA0','\xE1','\xBB','\xA2','\xE1','\xBB','\xA4','\xE1','\xBB','\xA6',
	'\xE1','\xBB','\xA8','\xE1','\xBB','\xAA','\xE1','\xBB','\xAC','\xE1',
	'\xBB','\xAE','\xE1','\xBB','\xB0','\xE1','\xBB','\xB2','\xE1','\xBB',
	'\xB4','\xE1','\xBB','\xB6','\xE1','\xBB','\xB8','\xE1','\xBB','\xBA',
	'\xE1','\xBB','\xBC','\xE1','\xBB','\xBE','\xE1','\xBC','\x88','\xE1',
	'\xBC','\x89','\xE1','\xBC','\x8A','\xE1','\xBC','\x8B','\xE1','\xBC',
	'\x8C','\xE1','\xBC','\x8D','\xE1','\xBC','\x8E','\xE1','\xBC','\x8F',
	'\xE1','\xBC','\x98','\xE1','\xBC','\x99','\xE1','\xBC','\x9A','\xE1',
	'\xBC','\x9B','\xE1','\xBC','\x9C','\xE1','\xBC','\x9D','\xE1','\xBC',
	'\xA8','\xE1','\xBC','\xA9','\xE1','\xBC','\xAA','\xE1','\xBC','\xAB',
	'\xE1','\xBC','\xAC','\xE1','\xBC','\xAD','\xE1','\xBC','\xAE','\xE1',
	'\xBC','\xAF','\xE1','\xBC','\xB8','\xE1','\xBC','\xB9','\xE1','\xBC',
	'\xBA','\xE1','\xBC','\xBB','\xE1','\xBC','\xBC','\xE1','\xBC','\xBD',
	'\xE1','\xBC','\xBE','\xE1','\xBC','\xBF','\xE1','\xBD','\x88','\xE1',
	'\xBD','\x89','\xE1','\xBD','\x8A','\xE1','\xBD','\x8B','\xE1','\xBD',
	'\x8C','\xE1','\xBD','\x8D','\xCE','\xA5','\xCC','\x93','\xE1','\xBD',
	'\x99','\xCE','\xA5','\xCC','\x93','\xCC','\x80','\xE1','\xBD','\x9B',
	'\xCE','\xA5','\xCC','\x93','\xCC','\x81','\xE1','\xBD','\x9D','\xCE',
	'\xA5','\xCC','\x93','\xCD','\x82','\xE1','\xBD','\x9F','\xE1','\xBD',
	'\xA8','\xE1','\xBD','\xA9','\xE1','\xBD','\xAA','\xE1','\xBD','\xAB',
	'\xE1','\xBD','\xAC','\xE1','\xBD','\xAD','\xE1','\xBD','\xAE','\xE1',
	'\xBD','\xAF','\xE1','\xBE','\xBA','\xE1','\xBE','\xBB','\xE1','\xBF',
	'\x88','\xE1','\xBF','\x89','\xE1','\xBF','\x8A','\xE1','\xBF','\x8B',
	'\xE1','\xBF','\x9A','\xE1','\xBF','\x9B','\xE1','\xBF','\xB8','\xE1',
	'\xBF','\xB9','\xE1','\xBF','\xAA','\xE1','\xBF','\xAB','\xE1','\xBF',
	'\xBA','\xE1','\xBF','\xBB','\xE1','\xBC','\x88','\xCE','\x99','\xE1',
	'\xBC','\x89','\xCE','\x99','\xE1','\xBC','\x8A','\xCE','\x99','\xE1',
	'\xBC','\x8B','\xCE','\x99','\xE1','\xBC','\x8C','\xCE','\x99','\xE1',
	'\xBC','\x8D','\xCE','\x99','\xE1','\xBC','\x8E','\xCE','\x99','\xE1',
	'\xBC','\x8F','\xCE','\x99','\xE1','\xBC','\xA8','\xCE','\x99','\xE1',
	'\xBC','\xA9','\xCE','\x99','\xE1','\xBC','\xAA','\xCE','\x99','\xE1',
	'\xBC','\xAB','\xCE','\x99','\xE1','\xBC','\xAC','\xCE','\x99','\xE1',
	'\xBC','\xAD','\xCE','\x99','\xE1','\xBC','\xAE','\xCE','\x99','\xE1',
	'\xBC','\xAF','\xCE','\x99','\xE1','\xBD','\xA8','\xCE','\x99','\xE1',
	'\xBD','\xA9','\xCE','\x99','\xE1','\xBD','\xAA','\xCE','\x99','\xE1',
	'\xBD','\xAB','\xCE','\x99','\xE1','\xBD','\xAC','\xCE','\x99','\xE1',
	'\xBD','\xAD','\xCE','\x99','\xE1','\xBD','\xAE','\xCE','\x99','\xE1',
	'\xBD','\xAF','\xCE','\x99','\xE1','\xBE','\xB8','\xE1','\xBE','\xB9',
	'\xE1','\xBE','\xBA','\xCE','\x99','\xCE','\x91','\xCE','\x99','\xCE',
	'\x86','\xCE','\x99','\xCE','\x91','\xCD','\x82','\xCE','\x91','\xCD',
	'\x82','\xCE','\x99','\xCE','\x99',255   ,'\xE1','\xBF','\x8A','\xCE',
	'\x99','\xCE','\x97','\xCE','\x99','\xCE','\x89','\xCE','\x99','\xCE',
	'\x97','\xCD','\x82','\xCE','\x97','\xCD','\x82','\xCE','\x99','\xE1',
	'\xBF','\x98','\xE1','\xBF','\x99','\xCE','\x99','\xCC','\x88','\xCC',
	'\x80','\xCE','\x99','\xCC','\x88','\xCC','\x81','\xCE','\x99','\xCD',
	'\x82','\xCE','\x99','\xCC','\x88','\xCD','\x82','\xE1','\xBF','\xA8',
	'\xE1','\xBF','\xA9','\xCE','\xA5','\xCC','\x88','\xCC','\x80','\xCE',
	'\xA5','\xCC','\x88','\xCC','\x81','\xCE','\xA1','\xCC','\x93','\xE1',
	'\xBF','\xAC','\xCE','\xA5','\xCD','\x82','\xCE','\xA5','\xCC','\x88',
	'\xCD','\x82','\xE1','\xBF','\xBA','\xCE','\x99','\xCE','\xA9','\xCE',
	'\x99','\xCE','\x8F','\xCE','\x99','\xCE','\xA9','\xCD','\x82','\xCE',
	'\xA9','\xCD','\x82','\xCE','\x99','\xE2','\x84','\xA6','\xE2','\x84',
	'\xAA','\xE2','\x84','\xAB','\xE2','\x84','\xB2','\xE2','\x85','\xA0',
	'\xE2','\x85','\xA1','\xE2','\x85','\xA2','\xE2','\x85','\xA3','\xE2',
	'\x85','\xA4','\xE2','\x85','\xA5','\xE2','\x85','\xA6','\xE2','\x85',
	'\xA7','\xE2','\x85','\xA8','\xE2','\x85','\xA9','\xE2','\x85','\xAA',
	'\xE2','\x85','\xAB','\xE2','\x85','\xAC','\xE2','\x85','\xAD','\xE2',
	'\x85','\xAE','\xE2','\x85','\xAF','\xE2','\x86','\x83','\xE2','\x92',
	'\xB6','\xE2','\x92','\xB7','\xE2','\x92','\xB8','\xE2','\x92','\xB9',
	'\xE2','\x92','\xBA','\xE2','\x92','\xBB','\xE2','\x92','\xBC','\xE2',
	'\x92','\xBD','\xE2','\x92','\xBE','\xE2','\x92','\xBF','\xE2','\x93',
	'\x80','\xE2','\x93','\x81','\xE2','\x93','\x82','\xE2','\x93','\x83',
	'\xE2','\x93','\x84','\xE2','\x93','\x85','\xE2','\x93','\x86','\xE2',
	'\x93','\x87','\xE2','\x93','\x88','\xE2','\x93','\x89','\xE2','\x93',
	'\x8A','\xE2','\x93','\x8B','\xE2','\x93','\x8C','\xE2','\x93','\x8D',
	'\xE2','\x93','\x8E','\xE2','\x93','\x8F','\xE2','\xB0','\x80','\xE2',
	'\xB0','\x81','\xE2','\xB0','\x82','\xE2','\xB0','\x83','\xE2','\xB0',
	'\x84','\xE2','\xB0','\x85','\xE2','\xB0','\x86','\xE2','\xB0','\x87',
	'\xE2','\xB0','\x88','\xE2','\xB0','\x89','\xE2','\xB0','\x8A','\xE2',
	'\xB0','\x8B','\xE2','\xB0','\x8C','\xE2','\xB0','\x8D','\xE2','\xB0',
	'\x8E','\xE2','\xB0','\x8F','\xE2','\xB0','\x90','\xE2','\xB0','\x91',
	'\xE2','\xB0','\x92','\xE2','\xB0','\x93','\xE2','\xB0','\x94','\xE2',
	'\xB0','\x95','\xE2','\xB0','\x96','\xE2','\xB0','\x97','\xE2','\xB0',
	'\x98','\xE2','\xB0','\x99','\xE2','\xB0','\x9A','\xE2','\xB0','\x9B',
	'\xE2','\xB0','\x9C','\xE2','\xB0','\x9D','\xE2','\xB0','\x9E','\xE2',
	'\xB0','\x9F','\xE2','\xB0','\xA0','\xE2','\xB0','\xA1','\xE2','\xB0',
	'\xA2','\xE2','\xB0','\xA3','\xE2','\xB0','\xA4','\xE2','\xB0','\xA5',
	'\xE2','\xB0','\xA6','\xE2','\xB0','\xA7','\xE2','\xB0','\xA8','\xE2',
	'\xB0','\xA9','\xE2','\xB0','\xAA','\xE2','\xB0','\xAB','\xE2','\xB0',
	'\xAC','\xE2','\xB0','\xAD','\xE2','\xB0','\xAE','\xE2','\xB1','\xA0',
	'\xE2','\xB1','\xA7','\xE2','\xB1','\xA9','\xE2','\xB1','\xAB','\xE2',
	'\xB1','\xB2','\xE2','\xB1','\xB5','\xE2','\xB2','\x80','\xE2','\xB2',
	'\x82','\xE2','\xB2','\x84','\xE2','\xB2','\x86','\xE2','\xB2','\x88',
	'\xE2','\xB2','\x8A','\xE2','\xB2','\x8C','\xE2','\xB2','\x8E','\xE2',
	'\xB2','\x90','\xE2','\xB2','\x92','\xE2','\xB2','\x94','\xE2','\xB2',
	'\x96','\xE2','\xB2','\x98','\xE2','\xB2','\x9A','\xE2','\xB2','\x9C',
	'\xE2','\xB2','\x9E','\xE2','\xB2','\xA0','\xE2','\xB2','\xA2','\xE2',
	'\xB2','\xA4','\xE2','\xB2','\xA6','\xE2','\xB2','\xA8','\xE2','\xB2',
	'\xAA','\xE2','\xB2','\xAC','\xE2','\xB2','\xAE','\xE2','\xB2','\xB0',
	'\xE2','\xB2','\xB2','\xE2','\xB2','\xB4','\xE2','\xB2','\xB6','\xE2',
	'\xB2','\xB8','\xE2','\xB2','\xBA','\xE2','\xB2','\xBC','\xE2','\xB2',
	'\xBE','\xE2','\xB3','\x80','\xE2','\xB3','\x82','\xE2','\xB3','\x84',
	'\xE2','\xB3','\x86','\xE2','\xB3','\x88','\xE2','\xB3','\x8A','\xE2',
	'\xB3','\x8C','\xE2','\xB3','\x8E','\xE2','\xB3','\x90','\xE2','\xB3',
	'\x92','\xE2','\xB3','\x94','\xE2','\xB3','\x96','\xE2','\xB3','\x98',
	'\xE2','\xB3','\x9A','\xE2','\xB3','\x9C','\xE2','\xB3','\x9E','\xE2',
	'\xB3','\xA0','\xE2','\xB3','\xA2','\xE2','\xB3','\xAB','\xE2','\xB3',
	'\xAD','\xE2','\xB3','\xB2','\xEA','\x99','\x80','\xEA','\x99','\x82',
	'\xEA','\x99','\x84','\xEA','\x99','\x86','\xEA','\x99','\x88','\xEA',
	'\x99','\x8A','\xEA','\x99','\x8C','\xEA','\x99','\x8E','\xEA','\x99',
	'\x90','\xEA','\x99','\x92','\xEA','\x99','\x94','\xEA','\x99','\x96',
	'\xEA','\x99','\x98','\xEA','\x99','\x9A','\xEA','\x99','\x9C','\xEA',
	'\x99','\x9E','\xEA','\x99','\xA0','\xEA','\x99','\xA2','\xEA','\x99',
	'\xA4','\xEA','\x99','\xA6','\xEA','\x99','\xA8','\xEA','\x99','\xAA',
	'\xEA','\x99','\xAC','\xEA','\x9A','\x80','\xEA','\x9A','\x82','\xEA',
	'\x9A','\x84','\xEA','\x9A','\x86','\xEA','\x9A','\x88','\xEA','\x9A',
	'\x8A','\xEA','\x9A','\x8C','\xEA','\x9A','\x8E','\xEA','\x9A','\x90',
	'\xEA','\x9A','\x92','\xEA','\x9A','\x94','\xEA','\x9A','\x96','\xEA',
	'\x9A','\x98','\xEA','\x9A','\x9A','\xEA','\x9C','\xA2','\xEA','\x9C',
	'\xA4','\xEA','\x9C','\xA6','\xEA','\x9C','\xA8','\xEA','\x9C','\xAA',
	'\xEA','\x9C','\xAC','\xEA','\x9C','\xAE','\xEA','\x9C','\xB2','\xEA',
	'\x9C','\xB4','\xEA','\x9C','\xB6','\xEA','\x9C','\xB8','\xEA','\x9C',
	'\xBA','\xEA','\x9C','\xBC','\xEA','\x9C','\xBE','\xEA','\x9D','\x80',
	'\xEA','\x9D','\x82','\xEA','\x9D','\x84','\xEA','\x9D','\x86','\xEA',
	'\x9D','\x88','\xEA','\x9D','\x8A','\xEA','\x9D','\x8C','\xEA','\x9D',
	'\x8E','\xEA','\x9D','\x90','\xEA','\x9D','\x92','\xEA','\x9D','\x94',
	'\xEA','\x9D','\x96','\xEA','\x9D','\x98','\xEA','\x9D','\x9A','\xEA',
	'\x9D','\x9C','\xEA','\x9D','\x9E','\xEA','\x9D','\xA0','\xEA','\x9D',
	'\xA2','\xEA','\x9D','\xA4','\xEA','\x9D','\xA6','\xEA','\x9D','\xA8',
	'\xEA','\x9D','\xAA','\xEA','\x9D','\xAC','\xEA','\x9D','\xAE','\xEA',
	'\x9D','\xB9','\xEA','\x9D','\xBB','\xEA','\x9D','\xBE','\xEA','\x9E',
	'\x80','\xEA','\x9E','\x82','\xEA','\x9E','\x84','\xEA','\x9E','\x86',
	'\xEA','\x9E','\x8B','\xEA','\x9E','\x90','\xEA','\x9E','\x92','\xEA',
	'\x9E','\x96','\xEA','\x9E','\x98','\xEA','\x9E','\x9A','\xEA','\x9E',
	'\x9C','\xEA','\x9E','\x9E','\xEA','\x9E','\xA0','\xEA','\x9E','\xA2',
	'\xEA','\x9E','\xA4','\xEA','\x9E','\xA6','\xEA','\x9E','\xA8','\x46',
	'\x46',255   ,'\x46','\x49',255   ,'\x46','\x4c',255   ,'\x46','\x46',
	'\x49','\x46','\x46','\x4c','\x53','\x54',255   ,'\x53','\x54',255   ,
	'\xD5','\x84','\xD5','\x86','\xD5','\x84','\xD4','\xB5','\xD5','\x84',
	'\xD4','\xBB','\xD5','\x8E','\xD5','\x86','\xD5','\x84','\xD4','\xBD',
	'\xEF','\xBC','\xA1','\xEF','\xBC','\xA2','\xEF','\xBC','\xA3','\xEF',
	'\xBC','\xA4','\xEF','\xBC','\xA5','\xEF','\xBC','\xA6','\xEF','\xBC',
	'\xA7','\xEF','\xBC','\xA8','\xEF','\xBC','\xA9','\xEF','\xBC','\xAA',
	'\xEF','\xBC','\xAB','\xEF','\xBC','\xAC','\xEF','\xBC','\xAD','\xEF',
	'\xBC','\xAE','\xEF','\xBC','\xAF','\xEF','\xBC','\xB0','\xEF','\xBC',
	'\xB1','\xEF','\xBC','\xB2','\xEF','\xBC','\xB3','\xEF','\xBC','\xB4',
	'\xEF','\xBC','\xB5','\xEF','\xBC','\xB6','\xEF','\xBC','\xB7','\xEF',
	'\xBC','\xB8','\xEF','\xBC','\xB9','\xEF','\xBC','\xBA',
	0
};

static
int charLength(const char *c)
{
	if ((c[0] & 0xf8) == 0xf0 && (c[1] & 0xc0) == 0x80 && (c[2] & 0xc0) == 0x80 && (c[3] & 0xc0) == 0x80)
		return 4;
	else if ((c[0] & 0xf0) == 0xe0 && (c[1] & 0xc0) == 0x80 && (c[2] & 0xc0) == 0x80)
		return 3;
	else if ((c[0] & 0xe0) == 0xc0 && (c[1] & 0xc0) == 0x80)
		return 2;
	else
		return 1;
}

// MARK: - Methods

struct Text make (const char *bytes, uint16_t length)
{
	return (struct Text){
		.bytes = bytes,
		.length = length,
	};
}

struct Text join (struct Text from, struct Text to)
{
	return make(from.bytes, to.bytes - from.bytes + to.length);
}

uint32_t codepoint (struct Text text, uint8_t *units)
{
	uint32_t cp = 0;
	
	switch (text.length)
	{
		default:
		case 4:
			if ((text.bytes[0] & 0xf8) == 0xf0 && (text.bytes[1] & 0xc0) == 0x80 && (text.bytes[2] & 0xc0) == 0x80 && (text.bytes[3] & 0xc0) == 0x80)
			{
				cp  = (text.bytes[0] & 0x07) << 18;
				cp |= (text.bytes[1] & 0x3f) << 12;
				cp |= (text.bytes[2] & 0x3f) << 6;
				cp |= (text.bytes[3] & 0x3f);
				if (units)
					*units = 4;
				
				break;
			}
		
		case 3:
			if ((text.bytes[0] & 0xf0) == 0xe0 && (text.bytes[1] & 0xc0) == 0x80 && (text.bytes[2] & 0xc0) == 0x80 )
			{
				cp  = (text.bytes[0] & 0x0f) << 12;
				cp |= (text.bytes[1] & 0x3f) << 6;
				cp |= (text.bytes[2] & 0x3f);
				if (units)
					*units = 3;
				
				break;
			}
		
		case 2:
			if ((text.bytes[0] & 0xe0) == 0xc0 && (text.bytes[1] & 0xc0) == 0x80)
			{
				cp  = (text.bytes[0] & 0x1f) << 6;
				cp |= (text.bytes[1] & 0x3f);
				if (units)
					*units = 2;
				
				break;
			}
		
		case 1:
			if (units)
				*units = 1;
			
			cp = *text.bytes;
			break;
		
		case 0:
			if (units)
				*units = 0;
			
			break;
	}
	
	return cp;
}

uint32_t nextCodepoint (struct Text *text)
{
	uint8_t units;
	uint32_t cp = codepoint(*text, &units);
	advance(text, units);
	return cp;
}

uint32_t prevCodepoint (struct Text *text)
{
	uint32_t cp = 0;
	
	switch (text->length)
	{
		default:
		case 4:
			if ((text->bytes[-4] & 0xf8) == 0xf0 && (text->bytes[-3] & 0xc0) == 0x80 && (text->bytes[-2] & 0xc0) == 0x80 && (text->bytes[-1] & 0xc0) == 0x80)
			{
				cp  = (*(--text->bytes) & 0x3f);
				cp |= (*(--text->bytes) & 0x3f) << 6;
				cp |= (*(--text->bytes) & 0x3f) << 12;
				cp |= (*(--text->bytes) & 0x07) << 18;
				text->length -= 4;
				break;
			}
			
		case 3:
			if ((text->bytes[-3] & 0xf0) == 0xe0 && (text->bytes[-2] & 0xc0) == 0x80 && (text->bytes[-1] & 0xc0) == 0x80)
			{
				cp  = (*(--text->bytes) & 0x3f);
				cp |= (*(--text->bytes) & 0x3f) << 6;
				cp |= (*(--text->bytes) & 0x0f) << 12;
				text->length -= 3;
				break;
			}
			
		case 2:
			if ((text->bytes[-2] & 0xe0) == 0xc0 && (text->bytes[-1] & 0xc0) == 0x80)
			{
				cp  = (*(--text->bytes) & 0x3f);
				cp |= (*(--text->bytes) & 0x1f) << 6;
				text->length -= 2;
				break;
			}
			
		case 1:
			cp = *(--text->bytes);
			--text->length;
			break;
			
		case 0:
			break;
	}
	return cp;
}

uint16_t advance (struct Text *text, uint16_t units)
{
	if (units >= text->length)
	{
		text->bytes += text->length;
		text->length = 0;
	}
	else
	{
		text->bytes += units;
		text->length -= units;
	}
	return text->length;
}

uint16_t toUTF16Length (struct Text text)
{
	uint16_t windex = 0;
	
	while (text.length)
		windex += nextCodepoint(&text) >= 0x010000? 2: 1;
	
	return windex;
}

uint16_t toUTF16 (struct Text text, uint16_t *wbuffer)
{
	uint16_t windex = 0;
	uint32_t cp;
	
	while (text.length)
	{
		cp = nextCodepoint(&text);
		
		if (cp >= 0x010000)
		{
			cp -= 0x010000;
			wbuffer[windex++] = ((cp >> 10) & 0x3ff) + 0xd800;
			wbuffer[windex++] = ((cp >>  0) & 0x3ff) + 0xdc00;
		}
		else
			wbuffer[windex++] = cp;
	}
	
	return windex;
}

char * toLower (struct Text i, char *o /* length x 2 */)
{
	char buffer[5];
	const char *p;
	int l;
	
	while (i.length)
	{
		l = charLength(i.bytes);
		memcpy(buffer, i.bytes, l);
		buffer[l] = '\0';
		advance(&i, l);
		p = buffer;
		
		if (l > 1 || isupper(*p))
		{
			p = strstr(uppers, p);
			if (p)
			{
				while (p[l] == (char)255) ++l;
				p = lowers + (p - uppers);
				while (p[l - 1] == (char)255) --l;
			}
		}
		
		memcpy(o, p, l);
		o += l;
	}
	
	return o;
}

char * toUpper (struct Text i, char *o /* length x 3 */)
{
	char buffer[5];
	const char *p;
	int l;
	
	while (i.length)
	{
		l = charLength(i.bytes);
		memcpy(buffer, i.bytes, l);
		buffer[l] = '\0';
		advance(&i, l);
		p = buffer;
		
		if (l > 1 || islower(*p))
		{
			p = strstr(lowers, p);
			if (p)
			{
				while (p[l] == (char)255) ++l;
				p = uppers + (p - lowers);
				while (p[l - 1] == (char)255) --l;
			}
		}
		
		memcpy(o, p, l);
		o += l;
	}
	
	return o;
}
